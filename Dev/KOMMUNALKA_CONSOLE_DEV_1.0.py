# KOMMUNALKA_FINAL.PY
# –£—á–µ—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ –∑–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É —Å –º–µ–Ω—é
# –ê–í–¢–û–†: werkzn

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
FIXED_RENT = 30000
MIN_YEAR = 2020
MAX_YEAR = 2050
FILE_NAME = "payments.txt"

# –°–ª–æ–≤–∞—Ä–∏ –º–µ—Å—è—Ü–µ–≤ (–¥–ª—è –æ–±–µ–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π)
MONTH_NAMES_FULL = {
    1: "–Ø–Ω–≤–∞—Ä—å", 2: "–§–µ–≤—Ä–∞–ª—å", 3: "–ú–∞—Ä—Ç", 4: "–ê–ø—Ä–µ–ª—å",
    5: "–ú–∞–π", 6: "–ò—é–Ω—å", 7: "–ò—é–ª—å", 8: "–ê–≤–≥—É—Å—Ç",
    9: "–°–µ–Ω—Ç—è–±—Ä—å", 10: "–û–∫—Ç—è–±—Ä—å", 11: "–ù–æ—è–±—Ä—å", 12: "–î–µ–∫–∞–±—Ä—å"
}

MONTH_NAMES_SHORT = {
    "01": "–Ø–Ω–≤", "02": "–§–µ–≤", "03": "–ú–∞—Ä", "04": "–ê–ø—Ä",
    "05": "–ú–∞–π", "06": "–ò—é–Ω", "07": "–ò—é–ª", "08": "–ê–≤–≥",
    "09": "–°–µ–Ω", "10": "–û–∫—Ç", "11": "–ù–æ—è", "12": "–î–µ–∫"
}

# ========== –§–£–ù–ö–¶–ò–Ø 1: –î–û–ë–ê–í–õ–ï–ù–ò–ï –ü–õ–ê–¢–ï–ñ–ê ==========
def add_payment():
    """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞"""
    # 1. –í–≤–æ–¥ –º–µ—Å—è—Ü–∞
    print("\n" + "-"*40)
    print("–®–ê–ì 1: –í–≤–æ–¥ –º–µ—Å—è—Ü–∞")
    print("-"*40)
    
    while True:
        month_input = input("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –º–µ—Å—è—Ü–∞ (–æ—Ç 01 –¥–æ 12): ").strip()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∏
        if not month_input:
            print("‚ùå –û—à–∏–±–∫–∞: –í—ã –Ω–µ –≤–≤–µ–ª–∏ –º–µ—Å—è—Ü. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.\n")
            continue
        
        if not month_input.isdigit():
            print(f"‚ùå –û—à–∏–±–∫–∞: '{month_input}' —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.\n")
            continue
        
        month_num = int(month_input)
        
        if month_num < 1 or month_num > 12:
            print(f"‚ùå –û—à–∏–±–∫–∞: {month_num} –Ω–µ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 01-12. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.\n")
            continue
        
        # –£—Å–ø–µ—Ö
        month_display = str(month_num).zfill(2)
        month_name_text = MONTH_NAMES_FULL[month_num]  # ‚Üê –ò–°–ü–û–õ–¨–ó–£–ï–ú –ù–ê–® –°–õ–û–í–ê–†–¨
        print(f"‚úÖ–ú–µ—Å—è—Ü: {month_display} ({month_name_text})")
        break
    
    # 2. –í–≤–æ–¥ –≥–æ–¥–∞
    print("\n" + "-"*40)
    print("–®–ê–ì 2: –í–≤–æ–¥ –≥–æ–¥–∞")
    print("-"*40)
    
    while True:
        year_input = input("–í–≤–µ–¥–∏—Ç–µ –≥–æ–¥ (4 —Ü–∏—Ñ—Ä—ã): ").strip()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∏
        if not year_input:
            print("‚ùå –û—à–∏–±–∫–∞: –ù—É–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –≥–æ–¥\n")
            continue
        
        if not year_input.isdigit():
            print(f"‚ùå –û—à–∏–±–∫–∞: '{year_input}' —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã\n")
            continue
        
        if len(year_input) != 4:
            print(f"‚ùå –û—à–∏–±–∫–∞: –ì–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 4 —Ü–∏—Ñ—Ä—ã. –í—ã –≤–≤–µ–ª–∏: {len(year_input)}\n")
            continue
        
        year_num = int(year_input)
        
        if year_num < MIN_YEAR:
            print(f"‚ùå –û—à–∏–±–∫–∞: –ì–æ–¥ {year_num} –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ ({MIN_YEAR})\n")
            continue
        
        if year_num > MAX_YEAR:
            print(f"‚ùå –û—à–∏–±–∫–∞: –ì–æ–¥ {year_num} –±–æ–ª—å—à–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ ({MAX_YEAR})\n")
            continue
        
        # –£—Å–ø–µ—Ö
        print(f"‚úÖ–ì–æ–¥: {year_num}")
        break
    
    # 3. –í–≤–æ–¥ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ —Ä–∞—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã
    print("\n" + "-"*40)
    print("–®–ê–ì 3: –í–≤–æ–¥ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã—Ö —É—Å–ª—É–≥")
    print("-"*40)
    
    while True:
        utilities_input = input("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –∑–∞ –∫–æ–º–º—É–Ω–∞–ª–∫—É: ").strip()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–µ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
        if not utilities_input:
            print("‚ùå –û—à–∏–±–∫–∞: –í—ã –Ω–µ –≤–≤–µ–ª–∏ —Å—É–º–º—É\n")
            continue
        
        # –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É
        utilities_input = utilities_input.replace(',', '.')
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Ç–æ—á–∫–∞ –≤ —á–∏—Å–ª–µ
        if utilities_input.count('.') > 1:
            print("‚ùå –û—à–∏–±–∫–∞: –í —á–∏—Å–ª–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Ç–æ—á–∫–∞\n")
            continue
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞: —á—Ç–æ –æ—Å—Ç–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –∏ —Ç–æ—á–∫–∞
        temp = utilities_input.replace('.', '', 1)
        if not temp.isdigit():
            print("‚ùå –û—à–∏–±–∫–∞: –í —Å—É–º–º–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –∏ –æ–¥–Ω–∞ —Ç–æ—á–∫–∞/–∑–∞–ø—è—Ç–∞—è\n")
            continue
        
        try:
            utilities = float(utilities_input)
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å—É–º–º–∞ –Ω–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è
            if utilities < 0:
                print("‚ùå –û—à–∏–±–∫–∞: –°—É–º–º–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π\n")
                continue
            
            print(f"‚úÖ –£—Å–ø–µ—à–Ω–æ! –°—É–º–º–∞: {utilities:.2f} —Ä—É–±.")
            break
            
        except ValueError:
            print("‚ùå –û—à–∏–±–∫–∞: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —á–∏—Å–ª–∞\n")
            continue
    
    # –†–∞—Å—á–µ—Ç
    total = FIXED_RENT + utilities
    
    # 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª
    print("\n" + "-"*40)
    
    try:
        with open(FILE_NAME, "a", encoding="utf-8") as file:
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —É–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
            record = f"{month_display}.{year_num}|{FIXED_RENT}|{utilities:.2f}|{total:.2f}\n"
            file.write(record)
        print(f"‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã")
    except Exception as e:
        print(f"‚ö† –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: {e}")
    
    # 5. –§–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥
    print("\n" + "="*50)
    print("–§–ò–ù–ê–õ–¨–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢")
    print("="*50)
    print(f"üìÖ –ü–µ—Ä–∏–æ–¥ —É—á–µ—Ç–∞: {month_display}.{year_num} ({month_name_text})")
    print(f"üè† –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–ª–∞—Ç–∞ –∑–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É: {FIXED_RENT:>10} —Ä—É–±.")
    print(f"üíß –ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏: {utilities:>18.2f} —Ä—É–±.")
    print("-"*40)
    print(f"üí∞ –û–ë–©–ê–Ø –°–£–ú–ú–ê –ö –û–ü–õ–ê–¢–ï: {total:>15.2f} —Ä—É–±.")
    print("="*50)
    
    # –ó–ê–ú–ï–ù–ò–¢–¨ input() –Ω–∞:
    print("–§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞")
    input("–ù–∞–∂–º–∏—Ç–µ Enter —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é...")

# ========== –§–£–ù–ö–¶–ò–Ø 2: –ü–†–û–°–ú–û–¢–† –ò–°–¢–û–†–ò–ò ==========
def view_history():
    """–ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π"""

    print("="*60)
    print("–ü–†–û–°–ú–û–¢–† –ò–°–¢–û–†–ò–ò –ü–õ–ê–¢–ï–ñ–ï–ô")
    print("="*60)
    
    try:
        # –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª
        with open(FILE_NAME, "r", encoding="utf-8") as file:
            lines = file.readlines()
            
            if not lines:
                print("\nüì≠ –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π –ø—É—Å—Ç–∞")
                print("\n–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂–∏, –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç 1 –≤ –º–µ–Ω—é")
                return
                
            # –í—ã–≤–æ–¥–∏–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            print(f"\nüìä –ù–∞–π–¥–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: {len(lines)}")
            print("-"*60)
            
            # –í—ã–≤–æ–¥–∏–º –≤—Å–µ –∑–∞–ø–∏—Å–∏
            total_all = 0
            for i, line in enumerate(lines, 1):
                line = line.strip()
                parts = line.split('|')
                
                if len(parts) == 4:
                    date, rent, util, total = parts
                    
                    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É (05.2024 -> –ú–∞–π 2024)
                    month_num, year = date.split('.')
                    month_name = MONTH_NAMES_SHORT.get(month_num, month_num)  # ‚Üê –ù–ê–® –°–õ–û–í–ê–†–¨
                    date_formatted = f"{month_name} {year}"
                    
                    print(f"{i:3}. {date_formatted:12} "
                          f"–ö–æ–º–º—É–Ω–∞–ª–∫–∞: {float(util):>8.2f} —Ä—É–±. | "
                          f"–ò—Ç–æ–≥–æ: {float(total):>10.2f} —Ä—É–±.")
                    
                    total_all += float(total)
            
            # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            print("-"*60)
            print(f"üí∞ –í—Å–µ–≥–æ –≤—ã–ø–ª–∞—á–µ–Ω–æ –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è: {total_all:>25.2f} —Ä—É–±.")
            
            if len(lines) > 0:
                avg_total = total_all / len(lines)
                print(f"üìä –°—Ä–µ–¥–Ω–∏–π –ø–ª–∞—Ç–µ–∂ –≤ –º–µ—Å—è—Ü: {avg_total:>30.2f} —Ä—É–±.")
            
            print("="*60)
            
    except FileNotFoundError:
        print(f"\nüì≠ –§–∞–π–ª '{FILE_NAME}' –Ω–µ –Ω–∞–π–¥–µ–Ω")
        print("\n–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —É—á–µ—Ç, –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç 1 –≤ –º–µ–Ω—é")
        print("–∏ –≤–Ω–µ—Å–∏—Ç–µ –ø–µ—Ä–≤—ã–π –ø–ª–∞—Ç–µ–∂")
    except Exception as e:
        print(f"\n‚ö† –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: {e}")
    
    # –ó–ê–ú–ï–ù–ò–¢–¨ input() –Ω–∞:
    print("–§—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏")
    input("–ù–∞–∂–º–∏—Ç–µ Enter —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é...")

# ========== –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ ==========
def main_menu():
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –ø—Ä–æ–≥—Ä–∞–º–º—ã"""
    while True:
        print("\n" + "="*50)
        print("üè† –£–ß–ï–¢ –†–ê–°–•–û–î–û–í –ó–ê –ö–í–ê–†–¢–ò–†–£")
        print("="*50)
        print("1. üìù –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂")
        print("2. üìä –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π")
        print("3. ‚ùå –í—ã–π—Ç–∏ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã")
        print("="*50)
        
        choice = input("–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ (1-3): ").strip()
        
        if choice == "1":
            add_payment()
        elif choice == "2":
            view_history()
        elif choice == "3":
            print("\n–î–æ —Å–≤–∏–¥–∞–Ω–∏—è! –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.")
            break
        else:
            print("\n‚ùå –û—à–∏–±–∫–∞! –í—ã–±–µ—Ä–∏—Ç–µ 1, 2 –∏–ª–∏ 3.")

# ========== –ó–ê–ü–£–°–ö –ü–†–û–ì–†–ê–ú–ú–´ ==========
if __name__ == "__main__":
    main_menu()

